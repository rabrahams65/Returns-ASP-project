{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { debounceTime, distinctUntilChanged, filter, map } from 'rxjs';\nimport { ModalDismissReasons } from '@ng-bootstrap/ng-bootstrap';\nlet AddNewComponent = class AddNewComponent {\n  constructor(fb, returnService, router, appService, userService, customerService, productService, faultService, ownerService, authService, modalService) {\n    this.fb = fb;\n    this.returnService = returnService;\n    this.router = router;\n    this.appService = appService;\n    this.userService = userService;\n    this.customerService = customerService;\n    this.productService = productService;\n    this.faultService = faultService;\n    this.ownerService = ownerService;\n    this.authService = authService;\n    this.modalService = modalService;\n    this.batchDateToggle = false;\n    this.closeResult = '';\n    this.customer = {};\n    this.product = {};\n    this.fault = {};\n    this.owner = {};\n    this.custIdFromTemplate = '';\n    this.prodIdFromTemplate = '';\n    this.faultIdFromTemplate = '';\n    this.ownerIdFromTemplate = '';\n    this.customerList = [];\n    this.productList = [];\n    this.faultList = [];\n    this.ownerList = [];\n    this.notFound = 'Not Found';\n    this.notLoaded = 'Not Loaded';\n    this.formInvalid = '';\n    this.userId = this.notLoaded;\n    this.custFormatter = customer => customer.customerName;\n    this.prodFormatter = product => product.productName;\n    this.faultFormatter = fault => fault.name;\n    this.ownerFormatter = owner => owner.firstName;\n    //Gets all customers for searchbox\n    this.searchCust = text$ => {\n      return text$.pipe(debounceTime(200), distinctUntilChanged(), filter(term => term.length >= 2), map(term => this.customerList.filter(customer => new RegExp(term, 'mi').test(customer.customerName)).slice(0, 10)));\n    };\n    //Gets all products for searchbox\n    this.searchProd = text$ => {\n      return text$.pipe(debounceTime(200), distinctUntilChanged(), filter(term => term.length >= 2), map(term => this.productList.filter(product => new RegExp(term, 'mi').test(product.productName)).slice(0, 10)));\n    };\n    //Gets all faults for searchbox\n    this.searchFault = text$ => {\n      return text$.pipe(debounceTime(200), distinctUntilChanged(), filter(term => term.length >= 2), map(term => this.faultList.filter(fault => new RegExp(term, 'mi').test(fault.name)).slice(0, 10)));\n    };\n    //Gets all owners for searchbox\n    this.searchOwner = text$ => {\n      return text$.pipe(debounceTime(200), distinctUntilChanged(), filter(term => term.length >= 2), map(term => this.ownerList.filter(owner => new RegExp(term, 'mi').test(owner.firstName)).slice(0, 10)));\n    };\n    this.getUserId = userId => {\n      this.userId = userId;\n    };\n    this.form = this.fb.group({\n      customer: ['', Validators.nullValidator],\n      product: ['', Validators.nullValidator],\n      qtyOnDoc: [0],\n      qtyReturned: [0],\n      batchDate: [],\n      owner: [''],\n      fault: [''],\n      docNo: ['', Validators.required],\n      docDate: [, Validators.required],\n      resolved: [],\n      comment: ['']\n    });\n    this.showToast = false;\n    this.message = 'Something went wrong';\n    this.handleError = err => {\n      if (err.status == 404) {\n        this.router.navigate(['/search-returns']);\n      }\n      console.log(\"Response Error. Status: \", err.status);\n      console.log(\"Response Error. Status: \", err.statusText);\n      console.log(err);\n    };\n    //modals\n    //Modal Forms\n    this.newCustomerForm = this.fb.group({\n      customerName: [''],\n      email: [''],\n      address: [''],\n      shortCode: ['']\n    });\n    //customer Modal\n    //modal extensions\n    this.customerIdFromModal = '';\n    this.customerShortCodeFromTemplate = '';\n    this.customerAlreadyExists = 'Customer already exists';\n    this.customerShortCodeAlreadyExists = 'Short code already exists';\n  }\n  ngOnInit() {\n    this.userService.findUser({\n      email: this.authService.currentUser?.email\n    }).subscribe(u => {\n      this.getUserId(u.id);\n      console.log('The user id in the oninit subscribe call is: ' + this.userId);\n    });\n    this.customerService.searchCustomer().subscribe(c => this.customerList = c, this.handleError);\n    this.productService.searchProduct().subscribe(p => this.productList = p, this.handleError);\n    this.faultService.searchFault().subscribe(f => this.faultList = f, this.handleError);\n    this.ownerService.searchOwner().subscribe(o => this.ownerList = o, this.handleError);\n  }\n  //Gets the id and name of the model in the search criteria\n  getModel(modelName, type) {\n    let modelFound = [];\n    //Get the type of model\n    if (type == 'customerType') {\n      this.custIdFromTemplate = '';\n      let customerFound = this.customerList.filter(c => c.customerName?.toLowerCase().trim() == modelName?.toLowerCase().trim());\n      if (customerFound.length > 0) {\n        customerFound.map(c => {\n          this.custIdFromTemplate = c.id;\n          this.customer.customerName = c.customerName;\n        });\n        console.log('Get model gets called- custIdfromTemplate: {' + this.custIdFromTemplate + '} model name: ' + modelName);\n      } else if (customerFound.length <= 0) {\n        this.custIdFromTemplate = this.notFound;\n      }\n    } else if (type == 'newCustomerType') {\n      this.customerIdFromModal = '';\n      let customerFound = this.customerList.filter(c => c.customerName?.toLowerCase().trim() == modelName?.toLowerCase().trim());\n      if (customerFound.length > 0) {\n        this.customerIdFromModal = this.customerAlreadyExists;\n      }\n    }\n    if (type == 'productType') {\n      this.prodIdFromTemplate = '';\n      let productFound = this.productList.filter(p => p.productName?.toLowerCase().trim() == modelName?.toLowerCase().trim());\n      if (productFound.length > 0) {\n        productFound.map(p => {\n          this.prodIdFromTemplate = p.id;\n          this.product.productName = p.productName;\n        });\n      } else {\n        this.prodIdFromTemplate = this.notFound;\n      }\n    }\n    if (type == 'faultType') {\n      this.faultIdFromTemplate = '';\n      let faultFound = this.faultList.filter(f => f.name?.toLowerCase().trim() == modelName?.toLowerCase().trim());\n      if (faultFound.length > 0) {\n        faultFound.map(f => {\n          this.faultIdFromTemplate = f.id;\n          this.fault.name = f.name;\n        });\n      } else {\n        this.faultIdFromTemplate = this.notFound;\n      }\n    }\n    if (type == 'ownerType') {\n      this.ownerIdFromTemplate = '';\n      let ownerFound = this.ownerList.filter(o => o.firstName?.toLowerCase().trim() == modelName?.toLowerCase().trim());\n      if (ownerFound.length > 0) {\n        ownerFound.map(o => {\n          this.ownerIdFromTemplate = o.id;\n          this.owner.firstName = o.firstName;\n        });\n      } else {\n        this.ownerIdFromTemplate = this.notFound;\n      }\n    }\n  }\n  toggleBatch() {\n    this.batchDateToggle = !this.batchDateToggle;\n  }\n  save() {\n    if (this.form.invalid) {\n      this.form.markAllAsTouched();\n      console.log(\"Form is invalid\");\n      console.log(\"Customer valid?: \" + this.getCustomer.valid);\n      console.log(\"Product valid?: \" + this.getProduct.valid);\n      console.log(\"Fault valid?: \" + this.getFault.valid);\n      console.log(\"Owner valid?: \" + this.getOwner.valid);\n      console.log(\"User id is: \" + this.userId);\n      return;\n    }\n    this.message = 'Return Saved';\n    this.showToast = true;\n    const createdReturn = {\n      docDate: this.form.get('docDate')?.value,\n      customerId: this.custIdFromTemplate,\n      productId: this.prodIdFromTemplate,\n      qtyOnDoc: this.form.get('qtyOnDoc')?.value,\n      batchDate: this.form.get('batchDate')?.value,\n      ownerId: this.ownerIdFromTemplate,\n      faultId: this.faultIdFromTemplate,\n      docNo: this.form.get('docNo')?.value,\n      qtyReturned: this.form.get('qtyReturned')?.value,\n      resolved: JSON.parse(this.form.controls.resolved.value),\n      comment: this.form.get('comment')?.value,\n      userId: this.userId\n    };\n    this.returnService.createReturnReturn({\n      body: createdReturn\n    }).subscribe(_ => {\n      this.appService.setMessage(this.message);\n      this.appService.showToast(this.showToast);\n    }, this.handleError);\n    this.router.navigate(['/search-returns']);\n  }\n  //getters\n  get getDocDate() {\n    return this.form.controls.docDate;\n  }\n  get getCustomer() {\n    return this.form.controls.customer;\n  }\n  get getProduct() {\n    return this.form.controls.product;\n  }\n  get getQtyOnDoc() {\n    return this.form.controls.qtyOnDoc;\n  }\n  get getBatchDate() {\n    return this.form.controls.batchDate;\n  }\n  get getOwner() {\n    return this.form.controls.owner;\n  }\n  get getFault() {\n    return this.form.controls.fault;\n  }\n  get getDocNo() {\n    return this.form.controls.docNo;\n  }\n  get getQtyReturned() {\n    return this.form.controls.qtyReturned;\n  }\n  get getResolved() {\n    return this.form.controls.resolved;\n  }\n  get getComment() {\n    return this.form.controls.comment;\n  }\n  //\n  //customer Modal\n  openCustomerModal(content) {\n    this.newCustomerForm.reset();\n    this.customerIdFromModal = '';\n    this.customerShortCodeFromTemplate = '';\n    this.modalService.open(content, {\n      ariaLabelledBy: 'modal-basic-title'\n    }).result.then(result => {\n      this.closeResult = `Closed with: ${result}`;\n      this.saveNewCustomer();\n    }, reason => {\n      this.closeResult = `Dismissed ${this.getDismissReason(reason)}`;\n    });\n  }\n  getDismissReason(reason) {\n    if (reason === ModalDismissReasons.ESC) {\n      return 'by pressing ESC';\n    } else if (reason === ModalDismissReasons.BACKDROP_CLICK) {\n      return 'by clicking on a backdrop';\n    } else {\n      return `with: ${reason}`;\n    }\n  }\n  saveNewCustomer() {\n    if (this.customerIdFromModal == this.customerAlreadyExists || this.customerShortCodeFromTemplate == this.customerShortCodeAlreadyExists) {\n      return;\n    }\n    let newCustomer = {\n      customerName: this.newCustomerForm.controls.customerName.value,\n      email: this.newCustomerForm.controls.email.value,\n      address: this.newCustomerForm.controls.address.value,\n      shortCode: this.newCustomerForm.controls.shortCode.value\n    };\n    //console.log(newCustomer.customerName)\n    this.customerService.createCustomer({\n      body: newCustomer\n    }).subscribe(c => {\n      this.showToast = true;\n      if (this.form.valid) {\n        this.message = 'Customer added successfully';\n        console.log('Customer added successfully');\n        this.customerList = [];\n        this.customerService.searchCustomer().subscribe(c => this.customerList = c, this.handleError);\n        this.getCustomer.setValue(newCustomer.customerName);\n        this.getModel(newCustomer.customerName, 'newCustomerType');\n      } else if (this.form.valid && !this.form.touched && !this.form.dirty) {\n        this.message = 'Nothing added';\n        console.log('Nothing added');\n      }\n      //this.appService.setMessage(this.message);\n      //this.appService.showToast(this.showToast)\n    });\n\n    this.form.controls.customer.setValue(newCustomer.customerName);\n  }\n  customerExists(customerName) {\n    this.customerIdFromModal = '';\n    if (this.customer.customerName?.toLowerCase().trim() != customerName.toLowerCase().trim()) {\n      let customerFound = this.customerList.filter(c => c.customerName?.toLowerCase().trim() == customerName.toLowerCase().trim());\n      if (customerFound.length > 0) {\n        this.customerIdFromModal = this.customerAlreadyExists;\n      }\n    }\n  }\n  customerShortCodeExists(shortCode) {\n    this.customerShortCodeFromTemplate = '';\n    if (this.customer.shortCode?.toLowerCase().trim() != shortCode.toLowerCase().trim()) {\n      let skuFound = this.customerList.filter(s => s.shortCode?.toLowerCase().trim() == shortCode.toLowerCase().trim());\n      if (skuFound.length > 0) {\n        this.customerShortCodeFromTemplate = this.customerShortCodeAlreadyExists;\n      }\n    }\n  }\n};\nAddNewComponent = __decorate([Component({\n  selector: 'app-add-new',\n  templateUrl: './add-new.component.html',\n  styleUrls: ['./add-new.component.css']\n})], AddNewComponent);\nexport { AddNewComponent };","map":{"version":3,"mappings":";AAAA,SAASA,SAAS,QAAgB,eAAe;AACjD,SAAsBC,UAAU,QAAQ,gBAAgB;AAExD,SAASC,YAAY,EAAEC,oBAAoB,EAAEC,MAAM,EAAEC,GAAG,QAAsC,MAAM;AAKpG,SAASC,mBAAmB,QAAkB,4BAA4B;AAOnE,IAAMC,eAAe,GAArB,MAAMA,eAAe;EAK1BC,YAAoBC,EAAe,EAAUC,aAA4B,EAAUC,MAAc,EAAUC,UAAsB,EAAUC,WAAwB,EACzJC,eAAgC,EAAUC,cAA8B,EAAUC,YAA0B,EAAUC,YAA0B,EAChJC,WAAwB,EAAUC,YAAsB;IAF9C,OAAE,GAAFV,EAAE;IAAuB,kBAAa,GAAbC,aAAa;IAAyB,WAAM,GAANC,MAAM;IAAkB,eAAU,GAAVC,UAAU;IAAsB,gBAAW,GAAXC,WAAW;IAC5I,oBAAe,GAAfC,eAAe;IAA2B,mBAAc,GAAdC,cAAc;IAA0B,iBAAY,GAAZC,YAAY;IAAwB,iBAAY,GAAZC,YAAY;IAClI,gBAAW,GAAXC,WAAW;IAAuB,iBAAY,GAAZC,YAAY;IALxD,oBAAe,GAAG,KAAK;IACvB,gBAAW,GAAG,EAAE;IAMhB,aAAQ,GAAe,EAAE;IACzB,YAAO,GAAc,EAAE;IACvB,UAAK,GAAY,EAAE;IACnB,UAAK,GAAY,EAAE;IACnB,uBAAkB,GAAG,EAAE;IACvB,uBAAkB,GAAG,EAAE;IACvB,wBAAmB,GAAG,EAAE;IACxB,wBAAmB,GAAG,EAAE;IAExB,iBAAY,GAAiB,EAAE;IAC/B,gBAAW,GAAgB,EAAE;IAC7B,cAAS,GAAc,EAAE;IACzB,cAAS,GAAc,EAAE;IAEzB,aAAQ,GAAG,WAAW;IACtB,cAAS,GAAG,YAAY;IACxB,gBAAW,GAAG,EAAE;IAChB,WAAM,GAAG,IAAI,CAACC,SAAS;IAYvB,kBAAa,GAAIC,QAAoB,IAAKA,QAAQ,CAACC,YAAa;IAChE,kBAAa,GAAIC,OAAkB,IAAKA,OAAO,CAACC,WAAY;IAC5D,mBAAc,GAAIC,KAAc,IAAKA,KAAK,CAACC,IAAK;IAChD,mBAAc,GAAIC,KAAc,IAAKA,KAAK,CAACC,SAAU;IAErD;IACA,eAAU,GAA+GC,KAAyB,IAAI;MACpJ,OAAOA,KAAK,CAACC,IAAI,CACf5B,YAAY,CAAC,GAAG,CAAC,EACjBC,oBAAoB,EAAE,EACtBC,MAAM,CAAE2B,IAAI,IAAKA,IAAI,CAACC,MAAM,IAAI,CAAC,CAAC,EAClC3B,GAAG,CAAE0B,IAAI,IAAK,IAAI,CAACE,YAAY,CAAC7B,MAAM,CAAEiB,QAAQ,IAAK,IAAIa,MAAM,CAACH,IAAI,EAAE,IAAI,CAAC,CAACI,IAAI,CAACd,QAAQ,CAACC,YAAa,CAAC,CAAC,CAACc,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CACxH;IACH,CAAC;IAED;IACA,eAAU,GAA+GP,KAAyB,IAAI;MACpJ,OAAOA,KAAK,CAACC,IAAI,CACf5B,YAAY,CAAC,GAAG,CAAC,EACjBC,oBAAoB,EAAE,EACtBC,MAAM,CAAE2B,IAAI,IAAKA,IAAI,CAACC,MAAM,IAAI,CAAC,CAAC,EAClC3B,GAAG,CAAE0B,IAAI,IAAK,IAAI,CAACM,WAAW,CAACjC,MAAM,CAAEmB,OAAO,IAAK,IAAIW,MAAM,CAACH,IAAI,EAAE,IAAI,CAAC,CAACI,IAAI,CAACZ,OAAO,CAACC,WAAY,CAAC,CAAC,CAACY,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CACpH;IACH,CAAC;IAED;IACA,gBAAW,GAA+GP,KAAyB,IAAI;MACrJ,OAAOA,KAAK,CAACC,IAAI,CACf5B,YAAY,CAAC,GAAG,CAAC,EACjBC,oBAAoB,EAAE,EACtBC,MAAM,CAAE2B,IAAI,IAAKA,IAAI,CAACC,MAAM,IAAI,CAAC,CAAC,EAClC3B,GAAG,CAAE0B,IAAI,IAAK,IAAI,CAACO,SAAS,CAAClC,MAAM,CAAEqB,KAAK,IAAK,IAAIS,MAAM,CAACH,IAAI,EAAE,IAAI,CAAC,CAACI,IAAI,CAACV,KAAK,CAACC,IAAK,CAAC,CAAC,CAACU,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CACvG;IACH,CAAC;IAED;IACA,gBAAW,GAA+GP,KAAyB,IAAI;MACrJ,OAAOA,KAAK,CAACC,IAAI,CACf5B,YAAY,CAAC,GAAG,CAAC,EACjBC,oBAAoB,EAAE,EACtBC,MAAM,CAAE2B,IAAI,IAAKA,IAAI,CAACC,MAAM,IAAI,CAAC,CAAC,EAClC3B,GAAG,CAAE0B,IAAI,IAAK,IAAI,CAACQ,SAAS,CAACnC,MAAM,CAAEuB,KAAK,IAAK,IAAIO,MAAM,CAACH,IAAI,EAAE,IAAI,CAAC,CAACI,IAAI,CAACR,KAAK,CAACC,SAAU,CAAC,CAAC,CAACQ,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAC5G;IACH,CAAC;IAGO,cAAS,GAAII,MAAc,IAAI;MACrC,IAAI,CAACA,MAAM,GAAGA,MAAM;IACtB,CAAC;IAED,SAAI,GAAG,IAAI,CAAC/B,EAAE,CAACgC,KAAK,CAAC;MACnBpB,QAAQ,EAAE,CAAC,EAAE,EAAEpB,UAAU,CAACyC,aAAa,CAAC;MACxCnB,OAAO,EAAE,CAAC,EAAE,EAAEtB,UAAU,CAACyC,aAAa,CAAC;MACvCC,QAAQ,EAAE,CAAC,CAAC,CAAC;MACbC,WAAW,EAAE,CAAC,CAAC,CAAC;MAChBC,SAAS,EAAE,EAAE;MACblB,KAAK,EAAE,CAAC,EAAE,CAAC;MACXF,KAAK,EAAE,CAAC,EAAE,CAAC;MACXqB,KAAK,EAAE,CAAC,EAAE,EAAE7C,UAAU,CAAC8C,QAAQ,CAAC;MAChCC,OAAO,EAAE,GAAE/C,UAAU,CAAC8C,QAAQ,CAAC;MAC/BE,QAAQ,EAAE,EAAE;MACZC,OAAO,EAAE,CAAC,EAAE;KACb,CAAC;IAEF,cAAS,GAAG,KAAK;IACjB,YAAO,GAAG,sBAAsB;IAuGxB,gBAAW,GAAIC,GAAQ,IAAI;MAEjC,IAAIA,GAAG,CAACC,MAAM,IAAI,GAAG,EAAE;QACrB,IAAI,CAACzC,MAAM,CAAC0C,QAAQ,CAAC,CAAC,iBAAiB,CAAC,CAAC;;MAG3CC,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEJ,GAAG,CAACC,MAAM,CAAC;MACnDE,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEJ,GAAG,CAACK,UAAU,CAAC;MACvDF,OAAO,CAACC,GAAG,CAACJ,GAAG,CAAC;IAClB,CAAC;IA+CD;IAEA;IACA,oBAAe,GAAG,IAAI,CAAC1C,EAAE,CAACgC,KAAK,CAAC;MAC9BnB,YAAY,EAAE,CAAC,EAAE,CAAC;MAClBmC,KAAK,EAAE,CAAC,EAAE,CAAC;MACXC,OAAO,EAAE,CAAC,EAAE,CAAC;MACbC,SAAS,EAAE,CAAC,EAAE;KACf,CAAC;IA4BA;IACF;IACA,wBAAmB,GAAG,EAAE;IACxB,kCAA6B,GAAG,EAAE;IAClC,0BAAqB,GAAG,yBAAyB;IACjD,mCAA8B,GAAG,2BAA2B;EAxSW;EAqBvEC,QAAQ;IACN,IAAI,CAAC/C,WAAW,CAACgD,QAAQ,CAAC;MAAEJ,KAAK,EAAE,IAAI,CAACvC,WAAW,CAAC4C,WAAW,EAAEL;IAAM,CAAE,CAAC,CAACM,SAAS,CAACC,CAAC,IAAG;MACvF,IAAI,CAACC,SAAS,CAACD,CAAC,CAACE,EAAG,CAAC;MAAEZ,OAAO,CAACC,GAAG,CAAC,+CAA+C,GAAG,IAAI,CAACf,MAAM,CAAC;IACnG,CAAC,CAAC;IACF,IAAI,CAAC1B,eAAe,CAACqD,cAAc,EAAE,CAACJ,SAAS,CAACK,CAAC,IAAI,IAAI,CAACnC,YAAY,GAAGmC,CAAC,EAAE,IAAI,CAACC,WAAW,CAAC;IAC7F,IAAI,CAACtD,cAAc,CAACuD,aAAa,EAAE,CAACP,SAAS,CAACQ,CAAC,IAAI,IAAI,CAAClC,WAAW,GAAGkC,CAAC,EAAE,IAAI,CAACF,WAAW,CAAC;IAC1F,IAAI,CAACrD,YAAY,CAACwD,WAAW,EAAE,CAACT,SAAS,CAACU,CAAC,IAAI,IAAI,CAACnC,SAAS,GAAGmC,CAAC,EAAE,IAAI,CAACJ,WAAW,CAAC;IACpF,IAAI,CAACpD,YAAY,CAACyD,WAAW,EAAE,CAACX,SAAS,CAACY,CAAC,IAAI,IAAI,CAACpC,SAAS,GAAGoC,CAAC,EAAE,IAAI,CAACN,WAAW,CAAC;EACtF;EAqEA;EACAO,QAAQ,CAACC,SAAiB,EAAEC,IAAY;IACtC,IAAIC,UAAU,GAAU,EAAE;IAG1B;IACA,IAAID,IAAI,IAAI,cAAc,EAAE;MAC1B,IAAI,CAACE,kBAAkB,GAAG,EAAE;MAE5B,IAAIC,aAAa,GAAG,IAAI,CAAChD,YAAY,CAAC7B,MAAM,CAACgE,CAAC,IAAIA,CAAC,CAAC9C,YAAY,EAAE4D,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIN,SAAS,EAAEK,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MAC1H,IAAIF,aAAa,CAACjD,MAAM,GAAG,CAAC,EAAE;QAC5BiD,aAAa,CAAC5E,GAAG,CAAC+D,CAAC,IAAG;UAAG,IAAI,CAACY,kBAAkB,GAAGZ,CAAC,CAACF,EAAG;UAAE,IAAI,CAAC7C,QAAQ,CAACC,YAAY,GAAG8C,CAAC,CAAC9C,YAAa;QAAC,CAAC,CAAC;QACzGgC,OAAO,CAACC,GAAG,CAAC,8CAA8C,GAAG,IAAI,CAACyB,kBAAkB,GAAG,gBAAgB,GAAGH,SAAS,CAAC;OACrH,MACI,IAAII,aAAa,CAACjD,MAAM,IAAI,CAAC,EAAE;QAClC,IAAI,CAACgD,kBAAkB,GAAG,IAAI,CAACI,QAAQ;;KAE1C,MACI,IAAIN,IAAI,IAAI,iBAAiB,EAAE;MAClC,IAAI,CAACO,mBAAmB,GAAG,EAAE;MAC7B,IAAIJ,aAAa,GAAG,IAAI,CAAChD,YAAY,CAAC7B,MAAM,CAACgE,CAAC,IAAIA,CAAC,CAAC9C,YAAY,EAAE4D,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIN,SAAS,EAAEK,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MAE1H,IAAIF,aAAa,CAACjD,MAAM,GAAG,CAAC,EAAE;QAC5B,IAAI,CAACqD,mBAAmB,GAAG,IAAI,CAACC,qBAAqB;;;IAIzD,IAAIR,IAAI,IAAI,aAAa,EAAE;MACzB,IAAI,CAACS,kBAAkB,GAAG,EAAE;MAC5B,IAAIC,YAAY,GAAG,IAAI,CAACnD,WAAW,CAACjC,MAAM,CAACmE,CAAC,IAAIA,CAAC,CAAC/C,WAAW,EAAE0D,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIN,SAAS,EAAEK,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MACvH,IAAIK,YAAY,CAACxD,MAAM,GAAG,CAAC,EAAE;QAC3BwD,YAAY,CAACnF,GAAG,CAACkE,CAAC,IAAG;UAAG,IAAI,CAACgB,kBAAkB,GAAGhB,CAAC,CAACL,EAAG;UAAE,IAAI,CAAC3C,OAAO,CAACC,WAAW,GAAG+C,CAAC,CAAC/C,WAAY;QAAC,CAAC,CAAC;OACtG,MACI;QACH,IAAI,CAAC+D,kBAAkB,GAAG,IAAI,CAACH,QAAQ;;;IAG3C,IAAIN,IAAI,IAAI,WAAW,EAAE;MACvB,IAAI,CAACW,mBAAmB,GAAG,EAAE;MAC7B,IAAIC,UAAU,GAAG,IAAI,CAACpD,SAAS,CAAClC,MAAM,CAACqE,CAAC,IAAIA,CAAC,CAAC/C,IAAI,EAAEwD,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIN,SAAS,EAAEK,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MAC5G,IAAIO,UAAU,CAAC1D,MAAM,GAAG,CAAC,EAAE;QACzB0D,UAAU,CAACrF,GAAG,CAACoE,CAAC,IAAG;UAAG,IAAI,CAACgB,mBAAmB,GAAGhB,CAAC,CAACP,EAAG;UAAE,IAAI,CAACzC,KAAK,CAACC,IAAI,GAAG+C,CAAC,CAAC/C,IAAK;QAAC,CAAC,CAAC;OACrF,MACI;QACH,IAAI,CAAC+D,mBAAmB,GAAG,IAAI,CAACL,QAAQ;;;IAG5C,IAAIN,IAAI,IAAI,WAAW,EAAE;MACvB,IAAI,CAACa,mBAAmB,GAAG,EAAE;MAC7B,IAAIC,UAAU,GAAG,IAAI,CAACrD,SAAS,CAACnC,MAAM,CAACuE,CAAC,IAAIA,CAAC,CAAC/C,SAAS,EAAEsD,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIN,SAAS,EAAEK,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MACjH,IAAIS,UAAU,CAAC5D,MAAM,GAAG,CAAC,EAAE;QACzB4D,UAAU,CAACvF,GAAG,CAACsE,CAAC,IAAG;UAAG,IAAI,CAACgB,mBAAmB,GAAGhB,CAAC,CAACT,EAAG;UAAE,IAAI,CAACvC,KAAK,CAACC,SAAS,GAAG+C,CAAC,CAAC/C,SAAU;QAAC,CAAC,CAAC;OAC/F,MACI;QACH,IAAI,CAAC+D,mBAAmB,GAAG,IAAI,CAACP,QAAQ;;;EAK9C;EAEAS,WAAW;IACT,IAAI,CAACC,eAAe,GAAG,CAAC,IAAI,CAACA,eAAe;EAC9C;EAEAC,IAAI;IACF,IAAI,IAAI,CAACC,IAAI,CAACC,OAAO,EAAE;MACrB,IAAI,CAACD,IAAI,CAACE,gBAAgB,EAAE;MAC5B5C,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;MAC9BD,OAAO,CAACC,GAAG,CAAC,mBAAmB,GAAG,IAAI,CAAC4C,WAAW,CAACC,KAAK,CAAC;MACzD9C,OAAO,CAACC,GAAG,CAAC,kBAAkB,GAAG,IAAI,CAAC8C,UAAU,CAACD,KAAK,CAAC;MACvD9C,OAAO,CAACC,GAAG,CAAC,gBAAgB,GAAG,IAAI,CAAC+C,QAAQ,CAACF,KAAK,CAAC;MACnD9C,OAAO,CAACC,GAAG,CAAC,gBAAgB,GAAG,IAAI,CAACgD,QAAQ,CAACH,KAAK,CAAC;MACnD9C,OAAO,CAACC,GAAG,CAAC,cAAc,GAAG,IAAI,CAACf,MAAM,CAAC;MACzC;;IAGF,IAAI,CAACgE,OAAO,GAAG,cAAc;IAC7B,IAAI,CAACC,SAAS,GAAG,IAAI;IAErB,MAAMC,aAAa,GAAc;MAC/B1D,OAAO,EAAE,IAAI,CAACgD,IAAI,CAACW,GAAG,CAAC,SAAS,CAAC,EAAEC,KAAM;MACzCC,UAAU,EAAE,IAAI,CAAC7B,kBAAkB;MACnC8B,SAAS,EAAE,IAAI,CAACvB,kBAAkB;MAClC5C,QAAQ,EAAE,IAAI,CAACqD,IAAI,CAACW,GAAG,CAAC,UAAU,CAAC,EAAEC,KAAM;MAC3C/D,SAAS,EAAE,IAAI,CAACmD,IAAI,CAACW,GAAG,CAAC,WAAW,CAAC,EAAEC,KAAM;MAC7CG,OAAO,EAAE,IAAI,CAACpB,mBAAmB;MACjCqB,OAAO,EAAE,IAAI,CAACvB,mBAAmB;MACjC3C,KAAK,EAAE,IAAI,CAACkD,IAAI,CAACW,GAAG,CAAC,OAAO,CAAC,EAAEC,KAAM;MACrChE,WAAW,EAAE,IAAI,CAACoD,IAAI,CAACW,GAAG,CAAC,aAAa,CAAC,EAAEC,KAAM;MACjD3D,QAAQ,EAAEgE,IAAI,CAACC,KAAK,CAAC,IAAI,CAAClB,IAAI,CAACmB,QAAQ,CAAClE,QAAQ,CAAC2D,KAAM,CAAC;MACxD1D,OAAO,EAAE,IAAI,CAAC8C,IAAI,CAACW,GAAG,CAAC,SAAS,CAAC,EAAEC,KAAM;MACzCpE,MAAM,EAAE,IAAI,CAACA;KACd;IAID,IAAI,CAAC9B,aAAa,CAAC0G,kBAAkB,CAAC;MAAEC,IAAI,EAAEX;IAAa,CAAE,CAAC,CAAC3C,SAAS,CAACuD,CAAC,IAAG;MAAG,IAAI,CAAC1G,UAAU,CAAC2G,UAAU,CAAC,IAAI,CAACf,OAAO,CAAC;MAAE,IAAI,CAAC5F,UAAU,CAAC6F,SAAS,CAAC,IAAI,CAACA,SAAS,CAAC;IAAC,CAAC,EAAE,IAAI,CAACpC,WAAW,CAAC;IACxL,IAAI,CAAC1D,MAAM,CAAC0C,QAAQ,CAAC,CAAC,iBAAiB,CAAC,CAAC;EAC3C;EAaA;EACA,IAAImE,UAAU;IACZ,OAAO,IAAI,CAACxB,IAAI,CAACmB,QAAQ,CAACnE,OAAO;EACnC;EAEA,IAAImD,WAAW;IACb,OAAO,IAAI,CAACH,IAAI,CAACmB,QAAQ,CAAC9F,QAAQ;EACpC;EAEA,IAAIgF,UAAU;IACZ,OAAO,IAAI,CAACL,IAAI,CAACmB,QAAQ,CAAC5F,OAAO;EACnC;EAEA,IAAIkG,WAAW;IACb,OAAO,IAAI,CAACzB,IAAI,CAACmB,QAAQ,CAACxE,QAAQ;EACpC;EAEA,IAAI+E,YAAY;IACd,OAAO,IAAI,CAAC1B,IAAI,CAACmB,QAAQ,CAACtE,SAAS;EACrC;EAEA,IAAI0D,QAAQ;IACV,OAAO,IAAI,CAACP,IAAI,CAACmB,QAAQ,CAACxF,KAAK;EACjC;EAEA,IAAI2E,QAAQ;IACV,OAAO,IAAI,CAACN,IAAI,CAACmB,QAAQ,CAAC1F,KAAK;EACjC;EAEA,IAAIkG,QAAQ;IACV,OAAO,IAAI,CAAC3B,IAAI,CAACmB,QAAQ,CAACrE,KAAK;EACjC;EAEA,IAAI8E,cAAc;IAChB,OAAO,IAAI,CAAC5B,IAAI,CAACmB,QAAQ,CAACvE,WAAW;EACvC;EAEA,IAAIiF,WAAW;IACb,OAAO,IAAI,CAAC7B,IAAI,CAACmB,QAAQ,CAAClE,QAAQ;EACpC;EAEA,IAAI6E,UAAU;IACZ,OAAO,IAAI,CAAC9B,IAAI,CAACmB,QAAQ,CAACjE,OAAO;EACnC;EAWA;EACE;EACF6E,iBAAiB,CAACC,OAAY;IAC5B,IAAI,CAACC,eAAe,CAACC,KAAK,EAAE;IAC5B,IAAI,CAAC7C,mBAAmB,GAAG,EAAE;IAC7B,IAAI,CAAC8C,6BAA6B,GAAG,EAAE;IAEvC,IAAI,CAAChH,YAAY,CAACiH,IAAI,CAACJ,OAAO,EAAE;MAAEK,cAAc,EAAE;IAAmB,CAAE,CAAC,CAACC,MAAM,CAACC,IAAI,CACjFD,MAAM,IAAI;MACT,IAAI,CAACE,WAAW,GAAG,gBAAgBF,MAAM,EAAE;MAC3C,IAAI,CAACG,eAAe,EAAE;IACxB,CAAC,EACAC,MAAM,IAAI;MACT,IAAI,CAACF,WAAW,GAAG,aAAa,IAAI,CAACG,gBAAgB,CAACD,MAAM,CAAC,EAAE;IACjE,CAAC,CACF;EACH;EAEQC,gBAAgB,CAACD,MAAW;IAClC,IAAIA,MAAM,KAAKpI,mBAAmB,CAACsI,GAAG,EAAE;MACtC,OAAO,iBAAiB;KACzB,MAAM,IAAIF,MAAM,KAAKpI,mBAAmB,CAACuI,cAAc,EAAE;MACxD,OAAO,2BAA2B;KACnC,MAAM;MACL,OAAO,SAASH,MAAM,EAAE;;EAE5B;EASAD,eAAe;IACb,IAAI,IAAI,CAACpD,mBAAmB,IAAI,IAAI,CAACC,qBAAqB,IAAI,IAAI,CAAC6C,6BAA6B,IAAI,IAAI,CAACW,8BAA8B,EAAE;MACvI;;IAGF,IAAIC,WAAW,GAAe;MAC5BzH,YAAY,EAAE,IAAI,CAAC2G,eAAe,CAACd,QAAQ,CAAC7F,YAAY,CAACsF,KAAK;MAC9DnD,KAAK,EAAE,IAAI,CAACwE,eAAe,CAACd,QAAQ,CAAC1D,KAAK,CAACmD,KAAK;MAChDlD,OAAO,EAAE,IAAI,CAACuE,eAAe,CAACd,QAAQ,CAACzD,OAAO,CAACkD,KAAK;MACpDjD,SAAS,EAAE,IAAI,CAACsE,eAAe,CAACd,QAAQ,CAACxD,SAAS,CAACiD;KACpD;IACD;IAEA,IAAI,CAAC9F,eAAe,CAACkI,cAAc,CAAC;MAAE3B,IAAI,EAAE0B;IAAW,CAAE,CAAC,CAAChF,SAAS,CAACK,CAAC,IAAG;MACvE,IAAI,CAACqC,SAAS,GAAG,IAAI;MACrB,IAAI,IAAI,CAACT,IAAI,CAACI,KAAK,EAAE;QACnB,IAAI,CAACI,OAAO,GAAG,6BAA6B;QAC5ClD,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;QAC1C,IAAI,CAACtB,YAAY,GAAG,EAAE;QACtB,IAAI,CAACnB,eAAe,CAACqD,cAAc,EAAE,CAACJ,SAAS,CAACK,CAAC,IAAI,IAAI,CAACnC,YAAY,GAAGmC,CAAC,EAAE,IAAI,CAACC,WAAW,CAAC;QAC7F,IAAI,CAAC8B,WAAW,CAAC8C,QAAQ,CAACF,WAAW,CAACzH,YAAa,CAAC;QACpD,IAAI,CAACsD,QAAQ,CAACmE,WAAW,CAACzH,YAAa,EAAC,iBAAiB,CAAC;OAC3D,MACI,IAAI,IAAI,CAAC0E,IAAI,CAACI,KAAK,IAAI,CAAC,IAAI,CAACJ,IAAI,CAACkD,OAAO,IAAI,CAAC,IAAI,CAAClD,IAAI,CAACmD,KAAK,EAAE;QAClE,IAAI,CAAC3C,OAAO,GAAG,eAAe;QAC9BlD,OAAO,CAACC,GAAG,CAAC,eAAe,CAAC;;MAE9B;MACA;IAEF,CAAC,CAAC;;IAEF,IAAI,CAACyC,IAAI,CAACmB,QAAQ,CAAC9F,QAAQ,CAAC4H,QAAQ,CAACF,WAAW,CAACzH,YAAa,CAAC;EAEjE;EAEA8H,cAAc,CAAC9H,YAAoB;IACjC,IAAI,CAAC+D,mBAAmB,GAAG,EAAE;IAC7B,IAAI,IAAI,CAAChE,QAAQ,CAACC,YAAY,EAAE4D,WAAW,EAAE,CAACC,IAAI,EAAE,IAAI7D,YAAY,CAAC4D,WAAW,EAAE,CAACC,IAAI,EAAE,EAAE;MACzF,IAAIF,aAAa,GAAG,IAAI,CAAChD,YAAY,CAAC7B,MAAM,CAACgE,CAAC,IAAIA,CAAC,CAAC9C,YAAY,EAAE4D,WAAW,EAAE,CAACC,IAAI,EAAE,IAAI7D,YAAY,CAAC4D,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MAC5H,IAAIF,aAAa,CAACjD,MAAM,GAAG,CAAC,EAAE;QAC5B,IAAI,CAACqD,mBAAmB,GAAG,IAAI,CAACC,qBAAqB;;;EAG3D;EAEA+D,uBAAuB,CAAC1F,SAAiB;IACvC,IAAI,CAACwE,6BAA6B,GAAG,EAAE;IACvC,IAAI,IAAI,CAAC9G,QAAQ,CAACsC,SAAS,EAAEuB,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIxB,SAAS,CAACuB,WAAW,EAAE,CAACC,IAAI,EAAE,EAAE;MACnF,IAAImE,QAAQ,GAAG,IAAI,CAACrH,YAAY,CAAC7B,MAAM,CAACmJ,CAAC,IAAIA,CAAC,CAAC5F,SAAS,EAAEuB,WAAW,EAAE,CAACC,IAAI,EAAE,IAAIxB,SAAS,CAACuB,WAAW,EAAE,CAACC,IAAI,EAAE,CAAC;MACjH,IAAImE,QAAQ,CAACtH,MAAM,GAAG,CAAC,EAAE;QACvB,IAAI,CAACmG,6BAA6B,GAAG,IAAI,CAACW,8BAA8B;;;EAG9E;CACD;AAzWYvI,eAAe,eAL3BP,SAAS,CAAC;EACTwJ,QAAQ,EAAE,aAAa;EACvBC,WAAW,EAAE,0BAA0B;EACvCC,SAAS,EAAE,CAAC,yBAAyB;CACtC,CAAC,GACWnJ,eAAe,CAyW3B;SAzWYA,eAAe","names":["Component","Validators","debounceTime","distinctUntilChanged","filter","map","ModalDismissReasons","AddNewComponent","constructor","fb","returnService","router","appService","userService","customerService","productService","faultService","ownerService","authService","modalService","notLoaded","customer","customerName","product","productName","fault","name","owner","firstName","text$","pipe","term","length","customerList","RegExp","test","slice","productList","faultList","ownerList","userId","group","nullValidator","qtyOnDoc","qtyReturned","batchDate","docNo","required","docDate","resolved","comment","err","status","navigate","console","log","statusText","email","address","shortCode","ngOnInit","findUser","currentUser","subscribe","u","getUserId","id","searchCustomer","c","handleError","searchProduct","p","searchFault","f","searchOwner","o","getModel","modelName","type","modelFound","custIdFromTemplate","customerFound","toLowerCase","trim","notFound","customerIdFromModal","customerAlreadyExists","prodIdFromTemplate","productFound","faultIdFromTemplate","faultFound","ownerIdFromTemplate","ownerFound","toggleBatch","batchDateToggle","save","form","invalid","markAllAsTouched","getCustomer","valid","getProduct","getFault","getOwner","message","showToast","createdReturn","get","value","customerId","productId","ownerId","faultId","JSON","parse","controls","createReturnReturn","body","_","setMessage","getDocDate","getQtyOnDoc","getBatchDate","getDocNo","getQtyReturned","getResolved","getComment","openCustomerModal","content","newCustomerForm","reset","customerShortCodeFromTemplate","open","ariaLabelledBy","result","then","closeResult","saveNewCustomer","reason","getDismissReason","ESC","BACKDROP_CLICK","customerShortCodeAlreadyExists","newCustomer","createCustomer","setValue","touched","dirty","customerExists","customerShortCodeExists","skuFound","s","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\PC\\source\\repos\\Returns-ASP-project\\Returns-ASP-project\\ClientApp\\src\\app\\add-new\\add-new.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { FormBuilder, Validators } from '@angular/forms';\r\nimport { Router } from '@angular/router';\r\nimport { debounceTime, distinctUntilChanged, filter, map, Observable, OperatorFunction } from 'rxjs';\r\nimport { CustomerRm, FaultRm, OwnerRm, ProductRm, ReturnDto, ReturnRm } from '../api/models';\r\nimport { CustomerService, FaultService, OwnerService, ProductService, ReturnService, UserService } from '../api/services';\r\nimport { AppService } from '../app.service';\r\nimport { AuthService } from '../auth/auth.service';\r\nimport { ModalDismissReasons, NgbModal } from '@ng-bootstrap/ng-bootstrap';\r\n\n@Component({\n  selector: 'app-add-new',\n  templateUrl: './add-new.component.html',\n  styleUrls: ['./add-new.component.css']\n})\nexport class AddNewComponent implements OnInit {\n\n  batchDateToggle = false;\n  closeResult = '';\n\n  constructor(private fb: FormBuilder, private returnService: ReturnService, private router: Router, private appService: AppService, private userService: UserService,\r\n    private customerService: CustomerService, private productService: ProductService, private faultService: FaultService, private ownerService: OwnerService,\n    private authService: AuthService, private modalService: NgbModal ) { }\n\n  customer: CustomerRm = {}\r\n  product: ProductRm = {}\r\n  fault: FaultRm = {}\r\n  owner: OwnerRm = {}\r\n  custIdFromTemplate = ''\r\n  prodIdFromTemplate = ''\r\n  faultIdFromTemplate = ''\r\n  ownerIdFromTemplate = ''\r\n\r\n  customerList: CustomerRm[] = []\r\n  productList: ProductRm[] = []\r\n  faultList: FaultRm[] = []\r\n  ownerList: OwnerRm[] = []\n\n  notFound = 'Not Found'\r\n  notLoaded = 'Not Loaded'\r\n  formInvalid = ''\n  userId = this.notLoaded\n\n  ngOnInit(): void {\n    this.userService.findUser({ email: this.authService.currentUser?.email! }).subscribe(u => {\r\n      this.getUserId(u.id!); console.log('The user id in the oninit subscribe call is: ' + this.userId)\r\n    })\n    this.customerService.searchCustomer().subscribe(c => this.customerList = c, this.handleError)\n    this.productService.searchProduct().subscribe(p => this.productList = p, this.handleError)\n    this.faultService.searchFault().subscribe(f => this.faultList = f, this.handleError)\n    this.ownerService.searchOwner().subscribe(o => this.ownerList = o, this.handleError)\n  }\n\n  custFormatter = (customer: CustomerRm) => customer.customerName!\r\n  prodFormatter = (product: ProductRm) => product.productName!\r\n  faultFormatter = (fault: FaultRm) => fault.name!\r\n  ownerFormatter = (owner: OwnerRm) => owner.firstName!\r\n\r\n  //Gets all customers for searchbox\r\n  searchCust: OperatorFunction<string, readonly { id?: string | undefined | null; name?: string | undefined | null }[]> = (text$: Observable<string>) => {\r\n    return text$.pipe(\r\n      debounceTime(200),\r\n      distinctUntilChanged(),\r\n      filter((term) => term.length >= 2),\r\n      map((term) => this.customerList.filter((customer) => new RegExp(term, 'mi').test(customer.customerName!)).slice(0, 10))\r\n    );\r\n  }\r\n\r\n  //Gets all products for searchbox\r\n  searchProd: OperatorFunction<string, readonly { id?: string | undefined | null; name?: string | undefined | null }[]> = (text$: Observable<string>) => {\r\n    return text$.pipe(\r\n      debounceTime(200),\r\n      distinctUntilChanged(),\r\n      filter((term) => term.length >= 2),\r\n      map((term) => this.productList.filter((product) => new RegExp(term, 'mi').test(product.productName!)).slice(0, 10))\r\n    );\r\n  }\r\n\r\n  //Gets all faults for searchbox\r\n  searchFault: OperatorFunction<string, readonly { id?: string | undefined | null; name?: string | undefined | null }[]> = (text$: Observable<string>) => {\r\n    return text$.pipe(\r\n      debounceTime(200),\r\n      distinctUntilChanged(),\r\n      filter((term) => term.length >= 2),\r\n      map((term) => this.faultList.filter((fault) => new RegExp(term, 'mi').test(fault.name!)).slice(0, 10))\r\n    );\r\n  }\r\n\r\n  //Gets all owners for searchbox\r\n  searchOwner: OperatorFunction<string, readonly { id?: string | undefined | null; name?: string | undefined | null }[]> = (text$: Observable<string>) => {\r\n    return text$.pipe(\r\n      debounceTime(200),\r\n      distinctUntilChanged(),\r\n      filter((term) => term.length >= 2),\r\n      map((term) => this.ownerList.filter((owner) => new RegExp(term, 'mi').test(owner.firstName!)).slice(0, 10))\r\n    );\r\n  }\r\n\n\n  private getUserId = (userId: string) => {\r\n    this.userId = userId\r\n  }\n\n  form = this.fb.group({\r\n    customer: ['', Validators.nullValidator],\r\n    product: ['', Validators.nullValidator],\r\n    qtyOnDoc: [0],\r\n    qtyReturned: [0],\r\n    batchDate: [],\r\n    owner: [''],\r\n    fault: [''],\r\n    docNo: ['', Validators.required],\r\n    docDate: [,Validators.required],\r\n    resolved: [],\r\n    comment: ['']\r\n  })\r\n\r\n  showToast = false;\r\n  message = 'Something went wrong'\r\n\r\n  //Gets the id and name of the model in the search criteria\r\n  getModel(modelName: string, type: string) {\r\n    let modelFound: any[] = []\r\n\r\n\r\n    //Get the type of model\r\n    if (type == 'customerType') {\r\n      this.custIdFromTemplate = ''\r\n\r\n      let customerFound = this.customerList.filter(c => c.customerName?.toLowerCase().trim() == modelName?.toLowerCase().trim())\r\n      if (customerFound.length > 0) {\r\n        customerFound.map(c => { this.custIdFromTemplate = c.id!; this.customer.customerName = c.customerName! })\r\n        console.log('Get model gets called- custIdfromTemplate: {' + this.custIdFromTemplate + '} model name: ' + modelName)\r\n      }\r\n      else if (customerFound.length <= 0) {\r\n        this.custIdFromTemplate = this.notFound\r\n      }\r\n    }\r\n    else if (type == 'newCustomerType') {\r\n      this.customerIdFromModal = ''\r\n      let customerFound = this.customerList.filter(c => c.customerName?.toLowerCase().trim() == modelName?.toLowerCase().trim())\r\n\r\n      if (customerFound.length > 0) {\r\n        this.customerIdFromModal = this.customerAlreadyExists\r\n      }  \r\n    }\r\n\r\n    if (type == 'productType') {\r\n      this.prodIdFromTemplate = ''\r\n      let productFound = this.productList.filter(p => p.productName?.toLowerCase().trim() == modelName?.toLowerCase().trim())\r\n      if (productFound.length > 0) {\r\n        productFound.map(p => { this.prodIdFromTemplate = p.id!; this.product.productName = p.productName! })\r\n      }\r\n      else {\r\n        this.prodIdFromTemplate = this.notFound\r\n      }\r\n    }\r\n    if (type == 'faultType') {\r\n      this.faultIdFromTemplate = ''\r\n      let faultFound = this.faultList.filter(f => f.name?.toLowerCase().trim() == modelName?.toLowerCase().trim())\r\n      if (faultFound.length > 0) {\r\n        faultFound.map(f => { this.faultIdFromTemplate = f.id!; this.fault.name = f.name! })\r\n      }\r\n      else {\r\n        this.faultIdFromTemplate = this.notFound\r\n      }\r\n    }\r\n    if (type == 'ownerType') {\r\n      this.ownerIdFromTemplate = ''\r\n      let ownerFound = this.ownerList.filter(o => o.firstName?.toLowerCase().trim() == modelName?.toLowerCase().trim())\r\n      if (ownerFound.length > 0) {\r\n        ownerFound.map(o => { this.ownerIdFromTemplate = o.id!; this.owner.firstName = o.firstName! })\r\n      }\r\n      else {\r\n        this.ownerIdFromTemplate = this.notFound\r\n      }\r\n    }\r\n\r\n\r\n  }\n\n  toggleBatch() {\n    this.batchDateToggle = !this.batchDateToggle;\r\n  }\n\n  save() {\r\n    if (this.form.invalid) {\r\n      this.form.markAllAsTouched()\r\n      console.log(\"Form is invalid\")\r\n      console.log(\"Customer valid?: \" + this.getCustomer.valid)\r\n      console.log(\"Product valid?: \" + this.getProduct.valid)\r\n      console.log(\"Fault valid?: \" + this.getFault.valid)\r\n      console.log(\"Owner valid?: \" + this.getOwner.valid)\r\n      console.log(\"User id is: \" + this.userId)\r\n      return\r\n    }\r\n\r\n    this.message = 'Return Saved'\r\n    this.showToast = true\r\n\r\n    const createdReturn: ReturnDto = {\r\n      docDate: this.form.get('docDate')?.value!,\r\n      customerId: this.custIdFromTemplate,\r\n      productId: this.prodIdFromTemplate,\r\n      qtyOnDoc: this.form.get('qtyOnDoc')?.value!,\r\n      batchDate: this.form.get('batchDate')?.value!,\r\n      ownerId: this.ownerIdFromTemplate,\r\n      faultId: this.faultIdFromTemplate,\r\n      docNo: this.form.get('docNo')?.value!,\r\n      qtyReturned: this.form.get('qtyReturned')?.value!,\r\n      resolved: JSON.parse(this.form.controls.resolved.value!),\r\n      comment: this.form.get('comment')?.value!,\r\n      userId: this.userId!\r\n    }\r\n\r\n\r\n\r\n    this.returnService.createReturnReturn({ body: createdReturn }).subscribe(_ => { this.appService.setMessage(this.message); this.appService.showToast(this.showToast) }, this.handleError)\r\n    this.router.navigate(['/search-returns'])\r\n  }\n\n  private handleError = (err: any) => {\r\n\r\n    if (err.status == 404) {\r\n      this.router.navigate(['/search-returns'])\r\n    }\r\n\r\n    console.log(\"Response Error. Status: \", err.status)\r\n    console.log(\"Response Error. Status: \", err.statusText)\r\n    console.log(err);\r\n  }\n\n  //getters\r\n  get getDocDate() {\r\n    return this.form.controls.docDate\r\n  }\r\n\r\n  get getCustomer() {\r\n    return this.form.controls.customer\r\n  }\r\n\r\n  get getProduct() {\r\n    return this.form.controls.product\r\n  }\r\n\r\n  get getQtyOnDoc() {\r\n    return this.form.controls.qtyOnDoc\r\n  }\r\n\r\n  get getBatchDate() {\r\n    return this.form.controls.batchDate\r\n  }\r\n\r\n  get getOwner() {\r\n    return this.form.controls.owner\r\n  }\r\n\r\n  get getFault() {\r\n    return this.form.controls.fault\r\n  }\r\n\r\n  get getDocNo() {\r\n    return this.form.controls.docNo\r\n  }\r\n\r\n  get getQtyReturned() {\r\n    return this.form.controls.qtyReturned\r\n  }\r\n\r\n  get getResolved() {\r\n    return this.form.controls.resolved\r\n  }\r\n\r\n  get getComment() {\r\n    return this.form.controls.comment\r\n  }\r\n\r\n  //modals\r\n\r\n  //Modal Forms\r\n  newCustomerForm = this.fb.group({\n    customerName: [''],\n    email: [''],\n    address: [''],\n    shortCode: [''],\n  })\r\n  //\r\n    //customer Modal\r\n  openCustomerModal(content: any) {\r\n    this.newCustomerForm.reset()\r\n    this.customerIdFromModal = ''\r\n    this.customerShortCodeFromTemplate = ''\r\n\r\n    this.modalService.open(content, { ariaLabelledBy: 'modal-basic-title' }).result.then(\r\n      (result) => {\r\n        this.closeResult = `Closed with: ${result}`;\r\n        this.saveNewCustomer()\r\n      },\r\n      (reason) => {\r\n        this.closeResult = `Dismissed ${this.getDismissReason(reason)}`;\r\n      },\r\n    );\r\n  }\r\n\r\n  private getDismissReason(reason: any): string {\r\n    if (reason === ModalDismissReasons.ESC) {\r\n      return 'by pressing ESC';\r\n    } else if (reason === ModalDismissReasons.BACKDROP_CLICK) {\r\n      return 'by clicking on a backdrop';\r\n    } else {\r\n      return `with: ${reason}`;\r\n    }\r\n  }\r\n    //customer Modal\r\n  //modal extensions\r\n  customerIdFromModal = ''\r\n  customerShortCodeFromTemplate = ''\r\n  customerAlreadyExists = 'Customer already exists'\r\n  customerShortCodeAlreadyExists = 'Short code already exists'\r\n\r\n\n  saveNewCustomer(): void {\n    if (this.customerIdFromModal == this.customerAlreadyExists || this.customerShortCodeFromTemplate == this.customerShortCodeAlreadyExists) {\n      return\n    }\n\n    let newCustomer: CustomerRm = {\n      customerName: this.newCustomerForm.controls.customerName.value,\n      email: this.newCustomerForm.controls.email.value,\n      address: this.newCustomerForm.controls.address.value,\n      shortCode: this.newCustomerForm.controls.shortCode.value\n    }\n    //console.log(newCustomer.customerName)\n\n    this.customerService.createCustomer({ body: newCustomer }).subscribe(c => {\n      this.showToast = true\n      if (this.form.valid) {\n        this.message = 'Customer added successfully'\n        console.log('Customer added successfully')\n        this.customerList = []\n        this.customerService.searchCustomer().subscribe(c => this.customerList = c, this.handleError)\n        this.getCustomer.setValue(newCustomer.customerName!)\n        this.getModel(newCustomer.customerName!,'newCustomerType')\n      }\n      else if (this.form.valid && !this.form.touched && !this.form.dirty) {\n        this.message = 'Nothing added'\n        console.log('Nothing added')\n      }\n      //this.appService.setMessage(this.message);\n      //this.appService.showToast(this.showToast)\n      \n    })\n\n    this.form.controls.customer.setValue(newCustomer.customerName!)\n\n  }\r\n\r\n  customerExists(customerName: string) {\n    this.customerIdFromModal = ''\n    if (this.customer.customerName?.toLowerCase().trim() != customerName.toLowerCase().trim()) {\n      let customerFound = this.customerList.filter(c => c.customerName?.toLowerCase().trim() == customerName.toLowerCase().trim())\n      if (customerFound.length > 0) {\n        this.customerIdFromModal = this.customerAlreadyExists\n      }\n    }\n  }\n\n  customerShortCodeExists(shortCode: string) {\n    this.customerShortCodeFromTemplate = ''\n    if (this.customer.shortCode?.toLowerCase().trim() != shortCode.toLowerCase().trim()) {\n      let skuFound = this.customerList.filter(s => s.shortCode?.toLowerCase().trim() == shortCode.toLowerCase().trim())\n      if (skuFound.length > 0) {\n        this.customerShortCodeFromTemplate = this.customerShortCodeAlreadyExists\n      }\n    }\n  }\r\n}\n\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}