{"ast":null,"code":"import { __decorate, __param } from \"tslib\";\nimport { formatDate } from '@angular/common';\nimport { Component, Inject, LOCALE_ID, ViewChild } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { debounceTime, distinctUntilChanged, filter, map } from 'rxjs';\nlet ReturnDetailComponent = class ReturnDetailComponent {\n  //form: FormGroup;\n  constructor(route, returnService, router, authService, fb, locale, appService, userService, customerService, productService, faultService, ownerService) {\n    /*    this.form = this.fb.group({})*/\n    this.route = route;\n    this.returnService = returnService;\n    this.router = router;\n    this.authService = authService;\n    this.fb = fb;\n    this.locale = locale;\n    this.appService = appService;\n    this.userService = userService;\n    this.customerService = customerService;\n    this.productService = productService;\n    this.faultService = faultService;\n    this.ownerService = ownerService;\n    this.returnId = 'not loaded';\n    this.batchDateDisable = false;\n    this.return = {};\n    this.customer = {};\n    this.product = {};\n    this.fault = {};\n    this.owner = {};\n    this.customerList = [];\n    this.message = 'Something went wrong...';\n    this.showToast = false;\n    this.userId = 'not loaded';\n    this.form = this.fb.group({\n      customer: ['', Validators.required],\n      product: ['', Validators.required],\n      customerList: [],\n      qtyOnDoc: [0],\n      qtyReturned: [0],\n      batchDate: [''],\n      owner: [''],\n      fault: [''],\n      docNo: ['', Validators.required],\n      docDate: ['', Validators.required],\n      resolved: [true],\n      comment: ['']\n    });\n    this.custFormatter = customer => customer.customerName;\n    this.prodFormatter = product => product.productName;\n    this.faultFormatter = fault => fault.name;\n    this.ownerFormatter = owner => owner.firstName;\n    this.search = text$ => {\n      //Gets all customers\n      /*console.log('Type of text: ' + typeof (text$))*/\n      var model = this.modelChanged;\n      console.log('Customer text box touched = ' + model);\n      this.customerService.searchCustomer().subscribe(c => {\n        this.customerList = c;\n        console.log(this.customerList);\n      }, this.handleError);\n      return text$.pipe(debounceTime(200), distinctUntilChanged(), filter(term => term.length >= 2), map(term => this.customerList.filter(customer => new RegExp(term, 'mi').test(customer.customerName)).slice(0, 10)));\n    };\n    this.modelChanged = model => {\n      console.log(typeof model);\n      return model;\n    };\n    this.findReturn = returnId => {\n      this.returnId = returnId ?? 'not passed';\n      this.returnService.findReturn({\n        id: this.returnId\n      }).subscribe(r => {\n        this.return = r;\n        this.customerService.findCustomer({\n          id: r.customerId\n        }).subscribe(c => this.setCustomerName(c), this.handleError);\n        this.productService.findProduct({\n          id: r.productId\n        }).subscribe(p => this.setProductName(p), this.handleError);\n        this.faultService.findFault({\n          id: r.faultId\n        }).subscribe(f => this.setFaultName(f), this.handleError);\n        this.ownerService.findOwner({\n          id: r.ownerId\n        }).subscribe(o => this.setOwnerName(o), this.handleError);\n        //this.userService.findUser({ }) set up endpoint to find user by Id as well\n      }, this.handleError);\n    };\n    this.handleError = err => {\n      if (err.status == 404) {\n        this.router.navigate(['/search-returns']);\n      }\n      console.log(\"Response Error. Status: \", err.status);\n      console.log(\"Response Error. Status: \", err.statusText);\n      console.log(err);\n    };\n    //use again if default resolved dropdown does not work again.\n    //this.form.controls['resolved'].setValue(\"Test\", { onlySelf: true });\n  }\n\n  ngAfterViewInit() {}\n  ngOnInit() {\n    if (!this.authService.currentUser) {\n      this.router.navigate(['/register-user']);\n    }\n    this.userService.findUser({\n      email: this.authService.currentUser?.email\n    }).subscribe(u => this.getUserId(u.id));\n    this.route.paramMap.subscribe(p => this.findReturn(p.get(\"returnId\")));\n  }\n  toggleBatch() {\n    this.batchDateDisable = !this.batchDateDisable;\n    if (this.batchDateDisable == true && this.return.batchDate?.length > 1) {\n      this.form.controls['batchDate'].disable();\n      this.form.controls.batchDate.setValue(null);\n    } else if (this.batchDateDisable == false && this.return.batchDate?.length > 1) {\n      this.form.controls['batchDate'].enable();\n    } else if (this.batchDateDisable == true) {\n      this.form.controls['batchDate'].enable();\n      this.form.controls.batchDate.setValue(null);\n    } else if (this.batchDateDisable == false) {\n      this.form.controls['batchDate'].disable();\n    }\n  }\n  getUserId(userId) {\n    this.userId = userId;\n  }\n  setCustomerName(customer) {\n    this.customer = customer;\n  }\n  setProductName(product) {\n    this.product = product;\n  }\n  setFaultName(fault) {\n    this.fault = fault;\n  }\n  setOwnerName(owner) {\n    this.owner = owner;\n  }\n  //Get by Id's\n  //private getCustomerIdByName(customerName: string): string {\n  //  let customer = 'Not found'\n  //  this.customerService.findByNameCustomer({ name: customerName }).subscribe(c => customerName = c.customerName!)\n  //  return customer\n  //}\n  update() {\n    //console.log(this.batchDate.value + ' ' + this.docDate.value)\n    if (!this.getCustomer.touched || !this.getCustomer.dirty) {\n      this.form.controls.customer.setValue(this.customer.customerName);\n    }\n    if ((!this.getDocDate.touched || !this.getDocDate.dirty) && this.getDocDate.value != '') {\n      this.form.controls.docDate.setValue(formatDate(this.return.docDate, 'yyyy-MM-dd', this.locale));\n    }\n    if (!this.getDocDate.touched || !this.getDocDate.dirty && this.getDocDate.value == null) {\n      this.form.controls.docDate.setValue(this.return.docDate);\n    }\n    if (!this.getProduct.touched || !this.getProduct.dirty) {\n      this.form.controls.product.setValue(this.product.productName);\n    }\n    if (!this.getQtyOnDoc.touched || !this.getQtyOnDoc.dirty) {\n      this.form.controls.qtyOnDoc.setValue(this.return.qtyOnDoc);\n    }\n    if ((!this.getBatchDate.touched || !this.getBatchDate.dirty) && this.getBatchDate.value != null) {\n      this.form.controls.batchDate.setValue(formatDate(this.return.batchDate, 'yyyy-MM-dd', this.locale));\n    }\n    if (!this.getBatchDate.touched || !this.getBatchDate.dirty && this.getBatchDate.value == null) {\n      this.form.controls.batchDate.setValue(this.return.batchDate);\n    }\n    if (!this.getOwner.touched || !this.getOwner.dirty) {\n      this.form.controls.owner.setValue(this.owner.firstName);\n    }\n    if (!this.getFault.touched || !this.getFault.dirty) {\n      this.form.controls.fault.setValue(this.fault.name);\n    }\n    if (!this.getDocNo.touched || !this.getDocNo.dirty) {\n      this.form.controls.docNo.setValue(this.return.docNo);\n    }\n    if (!this.getQtyReturned.touched || !this.getQtyReturned.dirty) {\n      this.form.controls.qtyReturned.setValue(this.return.qtyReturned);\n    }\n    if (!this.getResolved.touched || !this.getResolved.dirty) {\n      this.form.controls.resolved.setValue(this.return.resolved);\n    }\n    if (!this.getComment.touched || !this.getComment.dirty) {\n      this.form.controls.comment.setValue(this.return.comment);\n    }\n    //Conver objects to id's\n    let editedReturn = {\n      id: this.returnId,\n      docDate: this.form.controls.docDate.value,\n      customerId: this.form.controls.customer.value,\n      productId: this.form.controls.product.value,\n      qtyOnDoc: this.form.controls.qtyOnDoc.value,\n      batchDate: this.form.controls.batchDate.value,\n      ownerId: this.form.controls.owner.value,\n      faultId: this.form.controls.fault.value,\n      docNo: this.form.controls.docNo.value,\n      qtyReturned: this.form.controls.qtyReturned.value,\n      resolved: this.form.controls.resolved.value,\n      comment: this.form.controls.comment.value\n    };\n    if (this.form.invalid) {\n      //this.form.markAllAsTouched();\n      return;\n    }\n    if (this.form.valid && this.form.dirty && this.form.touched) {\n      this.message = 'Return updated successfully';\n      this.showToast = true;\n    } else if (this.form.valid && !this.form.touched && !this.form.dirty) {\n      this.message = 'Nothing updated';\n      this.showToast = true;\n    }\n    this.returnService.updateReturnReturn({\n      id: this.returnId,\n      body: editedReturn\n    }).subscribe(_ => {\n      this.appService.setMessage(this.message);\n      this.appService.showToast(this.showToast);\n    }, this.handleError);\n    this.router.navigate(['/']);\n  }\n  //getters\n  get getDocDate() {\n    return this.form.controls.docDate;\n  }\n  get getCustomer() {\n    return this.form.controls.customer;\n  }\n  get getProduct() {\n    return this.form.controls.product;\n  }\n  get getQtyOnDoc() {\n    return this.form.controls.qtyOnDoc;\n  }\n  get getBatchDate() {\n    return this.form.controls.batchDate;\n  }\n  get getOwner() {\n    return this.form.controls.owner;\n  }\n  get getFault() {\n    return this.form.controls.fault;\n  }\n  get getDocNo() {\n    return this.form.controls.docNo;\n  }\n  get getQtyReturned() {\n    return this.form.controls.qtyReturned;\n  }\n  get getResolved() {\n    return this.form.controls.resolved;\n  }\n  get getComment() {\n    return this.form.controls.comment;\n  }\n};\n__decorate([ViewChild('resolvedDropdown', {\n  static: true\n})], ReturnDetailComponent.prototype, \"resolvedDropdownRef\", void 0);\nReturnDetailComponent = __decorate([Component({\n  selector: 'app-return-detail',\n  templateUrl: './return-detail.component.html',\n  styleUrls: ['./return-detail.component.css']\n}), __param(5, Inject(LOCALE_ID))], ReturnDetailComponent);\nexport { ReturnDetailComponent };","map":{"version":3,"mappings":"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","names":["formatDate","Component","Inject","LOCALE_ID","ViewChild","Validators","debounceTime","distinctUntilChanged","filter","map","ReturnDetailComponent","constructor","route","returnService","router","authService","fb","locale","appService","userService","customerService","productService","faultService","ownerService","group","customer","required","product","customerList","qtyOnDoc","qtyReturned","batchDate","owner","fault","docNo","docDate","resolved","comment","customerName","productName","name","firstName","text$","model","modelChanged","console","log","searchCustomer","subscribe","c","handleError","pipe","term","length","RegExp","test","slice","returnId","findReturn","id","r","return","findCustomer","customerId","setCustomerName","findProduct","productId","p","setProductName","findFault","faultId","f","setFaultName","findOwner","ownerId","o","setOwnerName","err","status","navigate","statusText","ngAfterViewInit","ngOnInit","currentUser","findUser","email","u","getUserId","paramMap","get","toggleBatch","batchDateDisable","form","controls","disable","setValue","enable","userId","update","getCustomer","touched","dirty","getDocDate","value","getProduct","getQtyOnDoc","getBatchDate","getOwner","getFault","getDocNo","getQtyReturned","getResolved","getComment","editedReturn","invalid","valid","message","showToast","updateReturnReturn","body","_","setMessage","__decorate","static","selector","templateUrl","styleUrls","__param"],"sourceRoot":"","sources":["C:\\Users\\Rowan\\source\\repos\\Returns-ASP-project\\Returns-ASP-project\\ClientApp\\src\\app\\return-detail\\return-detail.component.ts"],"sourcesContent":["import { formatDate } from '@angular/common';\r\nimport { AfterViewInit, Component, ElementRef, Inject, LOCALE_ID, OnInit, ViewChild } from '@angular/core';\r\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { CustomerRm, FaultRm, OwnerRm, ProductRm, ReturnDto } from '../api/models';\r\nimport { ReturnRm } from '../api/models/return-rm';\r\nimport { CustomerService, FaultService, OwnerService, ProductService, ReturnService, UserService } from '../api/services';\r\nimport { AuthService } from '../auth/auth.service';\r\nimport { AppService } from '../app.service';\r\nimport { debounceTime, distinctUntilChanged, filter, map, Observable, OperatorFunction } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-return-detail',\r\n  templateUrl: './return-detail.component.html',\r\n  styleUrls: ['./return-detail.component.css']\r\n})\r\nexport class ReturnDetailComponent implements OnInit, AfterViewInit {\r\n  @ViewChild('resolvedDropdown', { static: true }) resolvedDropdownRef?: ElementRef<HTMLElement>;\r\n  //form: FormGroup;\r\n\r\n  constructor(private route: ActivatedRoute, private returnService: ReturnService, private router: Router, private authService: AuthService,\r\n    private fb: FormBuilder, @Inject(LOCALE_ID) private locale: string, private appService: AppService, private userService: UserService, private customerService: CustomerService,\r\n    private productService: ProductService, private faultService: FaultService, private ownerService: OwnerService  ) {\r\n\r\n/*    this.form = this.fb.group({})*/\r\n    \r\n\r\n   \r\n\r\n    //use again if default resolved dropdown does not work again.\r\n    //this.form.controls['resolved'].setValue(\"Test\", { onlySelf: true });\r\n}\r\n\r\n  ngAfterViewInit() {\r\n\r\n  }\r\n\r\n  returnId: string = 'not loaded'\r\n  batchDateDisable = false\r\n  return: ReturnRm = {}\r\n  customer: CustomerRm = {}\r\n  product: ProductRm = {}\r\n  fault: FaultRm = {}\r\n  owner: OwnerRm = {}\r\n\r\n  customerList: CustomerRm[] = []\r\n\r\n  message = 'Something went wrong...'\r\n  showToast = false;\r\n  userId = 'not loaded'\r\n\r\n  form = this.fb.group({\r\n    customer: ['', Validators.required],\r\n    product: ['', Validators.required],\r\n    customerList:[],\r\n    qtyOnDoc: [0],\r\n    qtyReturned: [0],\r\n    batchDate: [''],\r\n    owner: [''],\r\n    fault: [''],\r\n    docNo: ['', Validators.required],\r\n    docDate: ['', Validators.required],\r\n    resolved: [true],\r\n    comment: ['']\r\n  })\r\n\r\n  custFormatter = (customer: CustomerRm) => customer.customerName!\r\n  prodFormatter = (product: ProductRm) => product.productName!\r\n  faultFormatter = (fault: FaultRm) => fault.name!\r\n  ownerFormatter = (owner: OwnerRm) => owner.firstName!\r\n\r\n  search: OperatorFunction<string, readonly { id?: string | undefined | null; Name?: string | undefined | null }[]> = (text$: Observable<string>) => {\r\n\r\n    //Gets all customers\r\n    /*console.log('Type of text: ' + typeof (text$))*/\r\n    var model = this.modelChanged\r\n    console.log('Customer text box touched = ' + model)\r\n\r\n    this.customerService.searchCustomer().subscribe(c => { this.customerList = c; console.log(this.customerList) }, this.handleError)\r\n\r\n    return text$.pipe(\r\n          debounceTime(200),\r\n          distinctUntilChanged(),\r\n          filter((term) => term.length >= 2),\r\n          map((term) => this.customerList.filter((customer) => new RegExp(term, 'mi').test(customer.customerName!)).slice(0, 10))\r\n      );\r\n  }\r\n\r\n  modelChanged = (model: any): any => {\r\n    console.log(typeof(model))\r\n    return model\r\n  }\r\n\r\n\r\n  ngOnInit(): void {\r\n\r\n    if (!this.authService.currentUser) {\r\n      this.router.navigate(['/register-user'])\r\n    }\r\n\r\n    this.userService.findUser({ email: this.authService.currentUser?.email! }).subscribe(u => this.getUserId(u.id!))\r\n\r\n    this.route.paramMap.subscribe(p => this.findReturn(p.get(\"returnId\")));\r\n\r\n\r\n\r\n  }\r\n  \r\n  private findReturn = (returnId: string | null) => {\r\n    this.returnId = returnId ?? 'not passed';\r\n\r\n    this.returnService.findReturn({ id: this.returnId }).subscribe(r =>\r\n    {\r\n      this.return = r\r\n      this.customerService.findCustomer({ id: r.customerId! }).subscribe(c => this.setCustomerName(c), this.handleError)\r\n      this.productService.findProduct({ id: r.productId! }).subscribe(p => this.setProductName(p), this.handleError)\r\n      this.faultService.findFault({ id: r.faultId! }).subscribe(f => this.setFaultName(f), this.handleError)\r\n      this.ownerService.findOwner({ id: r.ownerId! }).subscribe(o => this.setOwnerName(o), this.handleError)\r\n      //this.userService.findUser({ }) set up endpoint to find user by Id as well\r\n    }\r\n      , this.handleError);\r\n  }\r\n\r\n  toggleBatch() {\r\n    this.batchDateDisable = !this.batchDateDisable;\r\n\r\n    if (this.batchDateDisable == true && this.return.batchDate?.length! > 1) {\r\n      this.form.controls['batchDate'].disable()\r\n      this.form.controls.batchDate.setValue(null)\r\n    }\r\n    else if (this.batchDateDisable == false && this.return.batchDate?.length! > 1) {\r\n      this.form.controls['batchDate'].enable()\r\n    }\r\n    else if (this.batchDateDisable == true ) {\r\n      this.form.controls['batchDate'].enable()\r\n      this.form.controls.batchDate.setValue(null)\r\n    }\r\n    else if (this.batchDateDisable == false) {\r\n      this.form.controls['batchDate'].disable()\r\n    }\r\n  }\r\n\r\n  private handleError = (err: any) => {\r\n\r\n    if (err.status == 404) {\r\n      this.router.navigate(['/search-returns'])\r\n    }\r\n      \r\n    console.log(\"Response Error. Status: \", err.status)\r\n    console.log(\"Response Error. Status: \", err.statusText)\r\n    console.log(err);\r\n  }\r\n\r\n  private getUserId(userId: string) {\r\n    this.userId = userId\r\n  }\r\n\r\n  private setCustomerName(customer: CustomerRm) {\r\n    this.customer = customer\r\n  }\r\n\r\n  private setProductName(product: ProductRm) {\r\n    this.product = product\r\n  }\r\n\r\n  private setFaultName(fault: FaultRm) {\r\n   this.fault = fault\r\n  }\r\n\r\n  private setOwnerName(owner: OwnerRm) {\r\n    this.owner = owner\r\n  }\r\n\r\n  //Get by Id's\r\n  //private getCustomerIdByName(customerName: string): string {\r\n  //  let customer = 'Not found'\r\n  //  this.customerService.findByNameCustomer({ name: customerName }).subscribe(c => customerName = c.customerName!)\r\n  //  return customer\r\n  //}\r\n\r\n  update() {\r\n\r\n\r\n\r\n    //console.log(this.batchDate.value + ' ' + this.docDate.value)\r\n\r\n    if (!this.getCustomer.touched || !this.getCustomer.dirty) {\r\n      this.form.controls.customer.setValue(this.customer.customerName!)\r\n    }\r\n    if ((!this.getDocDate.touched || !this.getDocDate.dirty) && this.getDocDate.value != '') {\r\n      this.form.controls.docDate.setValue(formatDate(this.return.docDate!, 'yyyy-MM-dd', this.locale))\r\n    }\r\n    if (!this.getDocDate.touched || !this.getDocDate.dirty && this.getDocDate.value == null) {\r\n      this.form.controls.docDate.setValue(this.return.docDate!)\r\n    }\r\n    if (!this.getProduct.touched || !this.getProduct.dirty) {\r\n      this.form.controls.product.setValue(this.product.productName!)\r\n    }\r\n    if (!this.getQtyOnDoc.touched || !this.getQtyOnDoc.dirty) {\r\n      this.form.controls.qtyOnDoc.setValue(this.return.qtyOnDoc!)\r\n    }\r\n    if ((!this.getBatchDate.touched || !this.getBatchDate.dirty) && this.getBatchDate.value != null) {\r\n      this.form.controls.batchDate.setValue(formatDate(this.return.batchDate!, 'yyyy-MM-dd', this.locale))\r\n    }\r\n    if (!this.getBatchDate.touched || !this.getBatchDate.dirty && this.getBatchDate.value == null) {\r\n      this.form.controls.batchDate.setValue(this.return.batchDate!)\r\n    }\r\n    if (!this.getOwner.touched || !this.getOwner.dirty) {\r\n      this.form.controls.owner.setValue(this.owner.firstName!)\r\n    }\r\n    if (!this.getFault.touched || !this.getFault.dirty) {\r\n      this.form.controls.fault.setValue(this.fault.name!)\r\n    }\r\n    if (!this.getDocNo.touched || !this.getDocNo.dirty) {\r\n      this.form.controls.docNo.setValue(this.return.docNo!)\r\n    }\r\n    if (!this.getQtyReturned.touched || !this.getQtyReturned.dirty) {\r\n      this.form.controls.qtyReturned.setValue(this.return.qtyReturned!)\r\n    }\r\n    if (!this.getResolved.touched || !this.getResolved.dirty) {\r\n      this.form.controls.resolved.setValue(this.return.resolved!)\r\n    }\r\n    if (!this.getComment.touched || !this.getComment.dirty) {\r\n      this.form.controls.comment.setValue(this.return.comment!)\r\n    }\r\n\r\n\r\n    //Conver objects to id's\r\n    let editedReturn: ReturnRm = {\r\n      id: this.returnId,\r\n      docDate: this.form.controls.docDate.value!,\r\n      customerId: this.form.controls.customer.value!,\r\n      productId: this.form.controls.product.value!,\r\n      qtyOnDoc: this.form.controls.qtyOnDoc.value!,\r\n      batchDate: this.form.controls.batchDate.value!,\r\n      ownerId: this.form.controls.owner.value!,\r\n      faultId: this.form.controls.fault.value!,\r\n      docNo: this.form.controls.docNo.value!,\r\n      qtyReturned: this.form.controls.qtyReturned.value!,\r\n      resolved: this.form.controls.resolved.value!,\r\n      comment: this.form.controls.comment.value!\r\n\r\n    }\r\n\r\n\r\n    if (this.form.invalid) {\r\n      //this.form.markAllAsTouched();\r\n      return\r\n    }\r\n    if (this.form.valid && this.form.dirty && this.form.touched) {\r\n      this.message = 'Return updated successfully'\r\n      this.showToast = true\r\n    }\r\n    else if (this.form.valid && !this.form.touched && !this.form.dirty) {\r\n      this.message = 'Nothing updated'\r\n      this.showToast = true\r\n    }\r\n  \r\n    this.returnService.updateReturnReturn({ id: this.returnId, body: editedReturn }).subscribe(_ => { this.appService.setMessage(this.message); this.appService.showToast(this.showToast)},this.handleError)\r\n    this.router.navigate(['/']);\r\n  }\r\n\r\n  //getters\r\n  get getDocDate() {\r\n    return this.form.controls.docDate\r\n  }\r\n\r\n  get getCustomer() {\r\n    return this.form.controls.customer\r\n  }\r\n\r\n  get getProduct() {\r\n    return this.form.controls.product\r\n  }\r\n\r\n  get getQtyOnDoc() {\r\n    return this.form.controls.qtyOnDoc\r\n  }\r\n\r\n  get getBatchDate() {\r\n    return this.form.controls.batchDate\r\n  }\r\n\r\n  get getOwner() {\r\n    return this.form.controls.owner\r\n  }\r\n\r\n  get getFault() {\r\n    return this.form.controls.fault\r\n  }\r\n\r\n  get getDocNo() {\r\n    return this.form.controls.docNo\r\n  }\r\n\r\n  get getQtyReturned() {\r\n    return this.form.controls.qtyReturned\r\n  }\r\n\r\n  get getResolved() {\r\n    return this.form.controls.resolved\r\n  }\r\n\r\n  get getComment() {\r\n    return this.form.controls.comment\r\n  }\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}